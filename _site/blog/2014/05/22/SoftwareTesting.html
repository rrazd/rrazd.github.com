<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
  <title> Software Testing |  Rashna Razdan</title>
  <meta content="Automated Static testing tool" name="description" />
  <meta content="testing, software, university, coverity, waterloo" name="keywords" />
  <meta name="author" content="Rashna Razdan">
  <meta name="HandheldFriendly" content="true" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>  
  <link rel="icon" type="image/png" href="/images/favicon.png" />
  <link rel="stylesheet" href="/assets/css/general.css">
  <link rel="stylesheet" href="/assets/css/blog.css">
  <link rel="stylesheet" href="/assets/css/contact.css">
  <!-- syntax highlighting CSS -->
  <link rel="stylesheet" href="/assets/css/syntax.css" type="text/css" />
  <link href='http://fonts.googleapis.com/css?family=Josefin+Sans:600' rel='stylesheet' type='text/css'>
  <link href='http://fonts.googleapis.com/css?family=Karla' rel='stylesheet' type='text/css'>

  <!-- Google Analytics -->      
  <script type="text/javascript">

  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-43164045-1']);
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();

  </script>  
</head>

<body class="blog" onorientationchange=window.location.reload();>
      <!--[if lt IE 7]>
          <p class="chromeframe">You are using an <strong>outdated</strong> browser. Please <a href="http://browsehappy.com/">upgrade your browser</a> or <a href="http://www.google.com/chromeframe/?redirect=true">activate Google Chrome Frame</a> to improve your experience.</p>
          <![endif]-->
          <div class="fact-spinner">
	<div class="wrap">
		<p class="facts"><span class="fact"></span> </p>
	</div>
</div>

          <header role="banner" class="page-wrap">
	<h1 class="branding">
			<div class="logo" href="/">
				<img src="/images/logo.png"/>
			</div> 
		<a href="/" id="owner-name">Rashna</a>

	</h1>
	<nav role="navigation">
		<ul>
			<li><a href="/" class="home">Home</a></li>
			<li><a href="/work" class="work">Work</a></li>
			<li><a href="/blog" class="blog">Blog</a></li>			
			<li><a href="/about" class="about">About</a></li>
			<li><a href = "/contact" class = "contact">Contact</a></li>	
		</ul>
	</nav>
</header>	


          <div class="page-wrap">

<article class="blog single" role="main">

	<header>
		

		<time class="post-date">May 22, 2014</time>
		
 				<a class="tag_list_link" href="/tag/learning">learning</a>
 			

		
		<h1 class="main-title">Software Testing</h1>
	</header>

	<h6>First of all you should understand the following:</h6>

<p>Fault potentially leads to Error which potentially leads to Failure<br/> </p>

<p>A fault is an incorrect line of code aka the pesky &#39;bug.&#39; 
This will not necessarily cause a compile time error, but the code line can be &#39;wrong&#39; nonetheless.<br/> 
The most common example of this is found in loop initialization and bounds. 
For example, the code below is supposed to find the number of even integers in an array [4,2,1,5,8] but we have a bug in our for loop 
because we are intitiallizing the loop iteration variable i to 1 instead of 0. Clearly, i must be 0 in order to find the number of even 
numbers within the array arr:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="kr">int</span><span class="p">[]</span> <span class="nx">arr</span> <span class="o">=</span> <span class="p">{</span><span class="mi">4</span><span class="p">,</span><span class="mi">2</span><span class="p">,</span><span class="mi">1</span><span class="p">,</span><span class="mi">5</span><span class="p">,</span><span class="mi">8</span><span class="p">};</span>
<span class="kr">int</span> <span class="nx">count</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
<span class="k">for</span><span class="p">(</span><span class="kr">int</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">arr</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">){</span>  <span class="o">&lt;&lt;&lt;</span> <span class="nx">bug</span> <span class="k">in</span> <span class="k">this</span> <span class="nx">line</span>
    <span class="k">if</span><span class="p">(</span><span class="nx">arr</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">%</span><span class="mi">2</span> <span class="o">==</span> <span class="mi">0</span><span class="p">){</span>
        <span class="nx">count</span><span class="o">++</span><span class="p">;</span>
    <span class="p">}</span>
<span class="p">}</span>
<span class="nx">System</span><span class="p">.</span><span class="nx">out</span><span class="p">.</span><span class="nx">println</span><span class="p">(</span><span class="nx">count</span><span class="p">);</span>
</code></pre></div>
<p><br/>
In this case the fault cases an error because we get an incorrect sequence of states. The first incorrect state is shown below.
The actual state are the state thats that the program will encounter if it is run with the buggy code. The expected state are the states
that will be seen with the bug-free version of the program.<br/>
Actual: S1 = {i = 1, arr = {4,2,1,5,8}, count = 0, PC = at line where initialization of loop occurs}<br/>
Expected: S1 = {i = 0, arr = {4,2,1,5,8}, count = 0, PC = at line where initialization of loop occurs}<br/></p>

<p>You will notice that I have included the Program Counter (PC) as part of the state of the program. PC points to the address of the instruction 
being executed (this usually can be thought of as a particular line of code within the program).
This is important information since an error can be due to the PC pointing to different lines of code. For instance, the actual PC might 
point to the end of a for-loop whereas the expected PC might point to the first line within the for-loop. <br/>
It is also important to note that in the for loop the PC first points to the initialization, then the comparison; based on if the result is T/F
the loop is entered. Upon completion of the loop&#39;s code block, PC points to the update portion of the for-loop and then performs the boolean check again. 
This is much more easily expressed via a control flow graph of the for-loop.
The following graph depicts this for-loop code:  <br/><br/></p>
<div class="highlight"><pre><code class="java language-java" data-lang="java"><span class="k">for</span><span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">array1</span><span class="o">.</span><span class="na">length</span><span class="o">();</span> <span class="n">i</span><span class="o">++){</span>
  <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;Hi&quot;</span><span class="o">);</span>
<span class="o">}</span>
<span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">print</span><span class="o">(</span><span class="s">&quot;bye&quot;</span><span class="o">);</span>
</code></pre></div>
<figure>
  <img src="/images/blog/cfg.png" alt="control-flow-graph">
</figure> 

<p>The aforesaid error leads to a failure in this example because the error can be externally observed due to the println(count) statement.</p>

<table>
   <thead>
      <tr>
         <th>Static testing tool: Coverity</th>
      </tr>
   </thead>
   <tbody>
      <tr>
         <td>
            - Code is not run<br/>
              - Do not need runtime environment to perform testing, just need the source code file(s) <br/>
            - False positives<br/>
            - Infers bugs solely based on statistics (probability), thus does not take into account any 
              domain knowledge
         </td>
      </tr>
   </tbody>
</table>

<table>
   <thead>
      <tr>
         <th>Dynamic testing tool: DAIKON</th>
      </tr>
   </thead>
   <tbody>
      <tr>
         <td>
            - Code is run<br/>
            - Need runtime environment set up i.e. if testing iphone app then need to have xCode installed <br/>
            - No false positives, the bug causes disruption/unexpected behaviour while application is running, thus know for certain that there is a bug
            <br/>
         </td>
      </tr>
   </tbody>
</table>

<p><br/></p>

<h6>The task at hand:</h6>

<p>I was tasked with creating an automated static analysis tool. The static analyzer learns what pairs of functions are usually called together. I then use these likely-invariants to automatically detect software bugs. In order to do this call graphs of the code were generated via LLVMâ€™s opt tool. The output of the opt tool (the callgraph) was redirected to an intermediate file. This had to be done because by default opt prints the call graph to stderr (represented by 2 in the script below). Moreover, opt was printing some extra content to stdout, this had to be sent to the dark recesses of /dev/null. In the end I had the following bash script (executible file):</p>
<div class="highlight"><pre><code class="bash language-bash" data-lang="bash"><span class="c">#!/bin/bash</span>
opt -print-callgraph <span class="nv">$1</span> 2&gt;intermediateFile 1&gt;/dev/null
<span class="c">#more code after this point</span>
</code></pre></div>
<p>A portion of a generated callgraph can be seen below:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">Call</span> <span class="nx">graph</span> <span class="nx">node</span> <span class="o">&lt;&lt;</span><span class="kc">null</span> <span class="kd">function</span><span class="o">&gt;&gt;&lt;&lt;</span><span class="mh">0x16d7abb0</span><span class="o">&gt;&gt;</span>  <span class="err">#</span><span class="nx">uses</span><span class="o">=</span><span class="mi">0</span>
  <span class="nx">CS</span><span class="o">&lt;</span><span class="mh">0x0</span><span class="o">&gt;</span> <span class="nx">calls</span> <span class="kd">function</span> <span class="s1">&#39;ap_get_server_built&#39;</span>
  <span class="nx">CS</span><span class="o">&lt;</span><span class="mh">0x0</span><span class="o">&gt;</span> <span class="nx">calls</span> <span class="kd">function</span> <span class="s1">&#39;ap_get_server_built&#39;</span>
  <span class="nx">CS</span><span class="o">&lt;</span><span class="mh">0x0</span><span class="o">&gt;</span> <span class="nx">calls</span> <span class="kd">function</span> <span class="s1">&#39;main&#39;</span>
  <span class="nx">CS</span><span class="o">&lt;</span><span class="mh">0x0</span><span class="o">&gt;</span> <span class="nx">calls</span> <span class="kd">function</span> <span class="s1">&#39;llvm.dbg.declare&#39;</span>
  <span class="nx">CS</span><span class="o">&lt;</span><span class="mh">0x0</span><span class="o">&gt;</span> <span class="nx">calls</span> <span class="kd">function</span> <span class="s1">&#39;strcmp&#39;</span>
  <span class="nx">CS</span><span class="o">&lt;</span><span class="mh">0x0</span><span class="o">&gt;</span> <span class="nx">calls</span> <span class="kd">function</span> <span class="s1">&#39;strcasecmp&#39;</span>
  <span class="nx">CS</span><span class="o">&lt;</span><span class="mh">0x0</span><span class="o">&gt;</span> <span class="nx">calls</span> <span class="kd">function</span> <span class="s1">&#39;strncasecmp&#39;</span>
  <span class="nx">CS</span><span class="o">&lt;</span><span class="mh">0x0</span><span class="o">&gt;</span> <span class="nx">calls</span> <span class="kd">function</span> <span class="s1">&#39;printf&#39;</span>
  <span class="nx">CS</span><span class="o">&lt;</span><span class="mh">0x0</span><span class="o">&gt;</span> <span class="nx">calls</span> <span class="kd">function</span> <span class="s1">&#39;suck_in_APR&#39;</span>
  <span class="nx">CS</span><span class="o">&lt;</span><span class="mh">0x0</span><span class="o">&gt;</span> <span class="nx">calls</span> <span class="kd">function</span> <span class="s1">&#39;strlen&#39;</span>
  <span class="nx">CS</span><span class="o">&lt;</span><span class="mh">0x0</span><span class="o">&gt;</span> <span class="nx">calls</span> <span class="kd">function</span> <span class="s1">&#39;exit&#39;</span>
  <span class="nx">CS</span><span class="o">&lt;</span><span class="mh">0x0</span><span class="o">&gt;</span> <span class="nx">calls</span> <span class="kd">function</span> <span class="s1">&#39;fprintf&#39;</span>

  <span class="c1">//more code here</span>

  <span class="nx">Call</span> <span class="nx">graph</span> <span class="nx">node</span> <span class="k">for</span> <span class="kd">function</span><span class="o">:</span> <span class="s1">&#39;default_build_command&#39;</span><span class="o">&lt;&lt;</span><span class="mh">0x1a349ee0</span><span class="o">&gt;&gt;</span>  <span class="err">#</span><span class="nx">uses</span><span class="o">=</span><span class="mi">1</span>
  <span class="nx">CS</span><span class="o">&lt;</span><span class="mh">0x19cc2ce8</span><span class="o">&gt;</span> <span class="nx">calls</span> <span class="kd">function</span> <span class="s1">&#39;strchr&#39;</span>
  <span class="nx">CS</span><span class="o">&lt;</span><span class="mh">0x19cc4958</span><span class="o">&gt;</span> <span class="nx">calls</span> <span class="nx">external</span> <span class="nx">node</span>
  <span class="nx">CS</span><span class="o">&lt;</span><span class="mh">0x19cc5330</span><span class="o">&gt;</span> <span class="nx">calls</span> <span class="nx">external</span> <span class="nx">node</span>
  <span class="nx">CS</span><span class="o">&lt;</span><span class="mh">0x19cc54e0</span><span class="o">&gt;</span> <span class="nx">calls</span> <span class="kd">function</span> <span class="s1">&#39;ap_unescape_url&#39;</span>
  <span class="nx">CS</span><span class="o">&lt;</span><span class="mh">0x19cc5698</span><span class="o">&gt;</span> <span class="nx">calls</span> <span class="nx">external</span> <span class="nx">node</span>

  <span class="c1">//more code here</span>
</code></pre></div>
<p>Since this was to be a static analysis tool, likely invariants had to be deduced. These invariants were derived by parsing the call graphs of a given java program. The static analyzer program looked at support and confidence metrics in order to determine if a bug was present or not. <br/>
By definition support is the number of times  a function is seen in the callgraph (support({A})) or a pair of function appears together support({A,B}). Confidence is the likelihood that the second functions appears given that the first function is present. </p>

<p>For instance support({A}) is 4 and support({A,B}) is 3, where A and B are function calls. We define confidence as support({A,B}) / support({A}) as confidence ({A,B}, {A}), which is 3/4.</p>

<p>Certain threshold values for support and confidence were hard coded in the program. If this threshold was surpassed within a function then a bug was present. A sample output of the program can be seen below:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="c1">//sample output</span>
<span class="nx">bug</span><span class="o">:</span> <span class="nx">A</span> <span class="k">in</span> <span class="nx">scope2</span><span class="p">,</span> <span class="nx">pair</span><span class="o">:</span> <span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">B</span><span class="p">),</span> <span class="nx">support</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">confidence</span><span class="o">:</span> <span class="mf">75.00</span><span class="o">%</span>
<span class="nx">bug</span><span class="o">:</span> <span class="nx">A</span> <span class="k">in</span> <span class="nx">scope3</span><span class="p">,</span> <span class="nx">pair</span><span class="o">:</span> <span class="p">(</span><span class="nx">A</span><span class="p">,</span> <span class="nx">D</span><span class="p">),</span> <span class="nx">support</span><span class="o">:</span> <span class="mi">3</span><span class="p">,</span> <span class="nx">confidence</span><span class="o">:</span> <span class="mf">75.00</span><span class="o">%</span>
</code></pre></div>
<p>The code involved hash tables galore and can be seen on my github. The implementation involved adding each function that was called in the program as a key to the hashtable. Then if we saw that function A() and B() were called within the code block of function C() then function B() is added to the hashset which was in turn the value for the A() key. The callgraphs that were tested were quite large: up to 20k nodes and 60k edges. The program was quite fast for these sizes (1483119000 ns). </p>

<p>Some of the hashtables used can be seen below:</p>
<div class="highlight"><pre><code class="javascript language-javascript" data-lang="javascript"><span class="nx">HashMap</span><span class="o">&lt;</span><span class="nx">Integer</span><span class="p">,</span> <span class="nx">HashSet</span><span class="o">&lt;</span><span class="nx">Integer</span><span class="o">&gt;&gt;</span> <span class="nx">statistics</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HashMap</span><span class="o">&lt;</span><span class="nx">Integer</span><span class="p">,</span><span class="nx">HashSet</span><span class="o">&lt;</span><span class="nx">Integer</span><span class="o">&gt;&gt;</span><span class="p">();</span>
<span class="nx">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="nx">Integer</span><span class="o">&gt;</span> <span class="nx">mappingTable</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HashMap</span><span class="o">&lt;</span><span class="nb">String</span><span class="p">,</span> <span class="nx">Integer</span><span class="o">&gt;</span><span class="p">();</span>
<span class="nx">HashMap</span><span class="o">&lt;</span><span class="nx">Integer</span><span class="p">,</span> <span class="nb">String</span><span class="o">&gt;</span> <span class="nx">mappingTableMapBack</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">HashMap</span><span class="o">&lt;</span><span class="nx">Integer</span><span class="p">,</span> <span class="nb">String</span><span class="o">&gt;</span><span class="p">();</span>
</code></pre></div>
<p>Some things that helped with the performance:<br/>
1) Avoid string comparison. Use some kind of ID instead.<br/>
2) Avoid using strings as keys in hash tables. Use some kind of ID instead.<br/>
3) In a nested loop, prune an iteration in the outer loop is more beneficial than in the inner loop.<br/></p>

<p>Finally Coverity was used to make sure that the static analyzer code was bug free. No notable bugs were detected. The output of Coverity can be seen below. 
<figure>
    <img src="/images/blog/coverityAnlysis.png" alt="coverity">
    <figurecaption>Coverity is a great static analysis tool</figurecaption>
</figure> </p>

<p>All in all, this was a great project to learn about static testing tools as well as getting a chance to play with Coverity. </p>


	
		<a href="/blog/" title="blog" class="large btn">Back to all posts</a>
	

</article>
</div>


          
          <div id="disqus_thread" class="page-wrap"></div>
          

          <header role="banner" class="page-wrap">
</header>	
<div class="page-wrap">
        <p class="disclaim">&copy; 2013 Rashna Razdan. Front and Back End Developer.</p>
        <br/>
</div>


          <script type="text/javascript">
          /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
        var disqus_shortname = 'rrazd'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
          var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
          dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
          (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
        </script>
        <noscript> <a href="http://disqus.com/?ref_noscript"></a></noscript>
        <a href="http://disqus.com" class="dsq-brlink"> <span class="logo-disqus"></span></a>
        
        
        <!-- scripts are recommended to be places before closing body tag -->

        <script src="/assets/js/jquery-1.10.1.min.js"></script>
        <script src="/assets/js/jquery.easing.min.js"></script>
        <script src="/assets/js/filters.js"></script>

      </body>
      </html>